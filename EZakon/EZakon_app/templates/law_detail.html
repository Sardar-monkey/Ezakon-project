{% extends 'base.html' %}
{% load static %}

{% block header %}
<header class="header">
    <div class="container">
        <div class="header_box">
            <div class="search is-easy">
                –õ–µ–≥–∫–∞—è
            </div>
            <div class="for_menu">
                <img src="{% static './images/Dots.svg' %}" alt="dots" class="dots" onclick="ShowMenu();">
                <div id="menu">
                    <hr class="line2">
                    <div class="menu_box">
                        {% if user.is_authenticated %}
                        <a href="{% url 'profile_page' %}">
                            <div class="menu_imgs">
                                <img src="{% static './images/Profile.svg' %}" alt="" class="menu_svg">
                            </div>
                        </a>
                        {% else %}
                        <a href="{% url 'sorry' %}">
                            <div class="menu_imgs">
                                <img src="{% static './images/Profile.svg' %}" alt="" class="menu_svg">
                            </div>
                        </a>                            
                        {% endif %}
                        <a href="{% url 'main_page' %}">
                            <div class="menu_imgs">
                                <img src="{% static './images/Home.svg' %}" alt="" class="menu_svg">
                            </div> 
                        </a>
                        <a href="{% url 'all_laws_page' %}">
                            <div class="menu_imgs">
                                <img src="{% static './images/Laws.svg' %}" alt="" class="menu_svg">
                            </div>
                        </a>
                        <a href="{% url 'lawyers_page' %}">
                            <div class="menu_imgs">
                                <img src="{% static './images/Lawers.svg' %}" alt="" class="menu_svg">
                            </div>
                        </a>
                        {% if user.is_authenticated %}
                        <a href="{% url 'chat_page' %}">
                            <div class="menu_imgs">
                                <img src="{% static './images/Ai.svg' %}" alt="" class="menu_svg">
                            </div>
                        </a>
                        {% else %}
                        <a href="{% url 'sorry' %}">
                            <div class="menu_imgs">
                                <img src="{% static './images/Ai.svg' %}" alt="" class="menu_svg">
                            </div>
                        </a>
                        {% endif %}
                    </div>
                    <div class="menu_imgs is-back">
                        <img src="{% static './images/arrow.svg' %}" alt="" class="menu_svg" onclick="ShowMenu();">
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<div class="for_line">
    <hr class="line">   
</div>
{% endblock %}

{% block content %}
<main>
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div style="margin-bottom: 30px;">
            <a href="{% url 'all_laws_page' %}" style="color: #007bff; text-decoration: none; font-size: 14px;">
                ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –∑–∞–∫–æ–Ω–æ–≤
            </a>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–æ–Ω–µ -->
        <div class="law-header" style="background: white; padding: 25px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                <div style="flex: 1;">
                    <h1 style="margin: 0 0 15px 0; color: #333; font-size: 28px;">{{ law.title }}</h1>
                    
                    <div style="display: flex; gap: 20px; margin-bottom: 15px; flex-wrap: wrap;">
                        <span style="color: #666; font-size: 14px;">
                            <strong>–ù–æ–º–µ—Ä:</strong> {{ law.number }}
                        </span>
                        <span style="color: #666; font-size: 14px;">
                            <strong>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ:</strong> {{ law.date_published|date:"d.m.Y" }}
                        </span>
                        <span style="color: #666; font-size: 14px;">
                            <strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> {{ law.date_updated|date:"d.m.Y" }}
                        </span>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <span class="badge" style="display: inline-block; padding: 6px 14px; margin-right: 10px; background: #e7f3ff; color: #007bff; border-radius: 20px; font-size: 12px; font-weight: 500;">
                            {{ law.get_category_display }}
                        </span>
                        {% if law.status == 'active' %}
                            <span class="badge" style="display: inline-block; padding: 6px 14px; margin-right: 10px; background: #d4edda; color: #155724; border-radius: 20px; font-size: 12px; font-weight: 500;">
                                ‚úì –î–µ–π—Å—Ç–≤—É—é—â–∏–π
                            </span>
                        {% elif law.status == 'deprecated' %}
                            <span class="badge" style="display: inline-block; padding: 6px 14px; margin-right: 10px; background: #f8d7da; color: #721c24; border-radius: 20px; font-size: 12px; font-weight: 500;">
                                ‚ö† –£—Å—Ç–∞—Ä–µ–≤—à–∏–π
                            </span>
                        {% elif law.status == 'archived' %}
                            <span class="badge" style="display: inline-block; padding: 6px 14px; margin-right: 10px; background: #e2e3e5; color: #383d41; border-radius: 20px; font-size: 12px; font-weight: 500;">
                                üì¶ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
                            </span>
                        {% elif law.status == 'draft' %}
                            <span class="badge" style="display: inline-block; padding: 6px 14px; margin-right: 10px; background: #fff3cd; color: #856404; border-radius: 20px; font-size: 12px; font-weight: 500;">
                                ‚úèÔ∏è –ß–µ—Ä–Ω–æ–≤–∏–∫
                            </span>
                        {% endif %}
                    </div>
                    
                    <p style="color: #555; font-size: 16px; line-height: 1.6; margin: 15px 0;">
                        <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ law.description }}
                    </p>
                </div>
                
                <div style="margin-left: 30px; text-align: center;">
                    {% if user.is_authenticated %}
                        {% if is_favorited %}
                            <a href="{% url 'remove_favorite_law' law.slug %}" class="btn" style="display: inline-block; padding: 12px 20px; background: #ffc107; color: #333; text-decoration: none; border-radius: 5px; border: none; cursor: pointer; font-weight: 500; margin-bottom: 10px;">
                                ‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–º
                            </a>
                        {% else %}
                            <a href="{% url 'add_favorite_law' law.slug %}" class="btn" style="display: inline-block; padding: 12px 20px; background: #e9ecef; color: #333; text-decoration: none; border-radius: 5px; border: 1px solid #ddd; cursor: pointer; font-weight: 500; margin-bottom: 10px;">
                                ‚òÜ –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                            </a>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'login_view' %}" class="btn" style="display: inline-block; padding: 12px 20px; background: #e9ecef; color: #333; text-decoration: none; border-radius: 5px; border: 1px solid #ddd; cursor: pointer; font-weight: 500; margin-bottom: 10px;">
                            ‚òÜ –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                        </a>
                    {% endif %}
                    
                    <div style="font-size: 13px; color: #999; margin-top: 15px;">
                        <div>üëÅÔ∏è {{ law.views_count }} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div>
                        <div>üí¨ {{ law.law_comments.count }} –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ì–ª–∞–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 30px;">
            <!-- –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –∑–∞–∫–æ–Ω–∞ -->
            <div class="law-full-text" style="background: white; padding: 25px; border-radius: 8px; border: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h2 style="margin-top: 0; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 15px;">–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç</h2>
                
                <div style="color: #555; line-height: 1.8; font-size: 15px; white-space: pre-wrap; word-wrap: break-word;">
                    {{ law.full_text }}
                </div>
            </div>

            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <aside style="background: white; padding: 25px; border-radius: 8px; border: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.1); height: fit-content;">
                <h3 style="margin-top: 0; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 15px;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                
                <div style="margin-bottom: 20px;">
                    <p style="margin: 0 0 8px 0; font-size: 12px; color: #999; text-transform: uppercase; font-weight: 500;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</p>
                    <p style="margin: 0; color: #333; font-size: 15px;">{{ law.get_category_display }}</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <p style="margin: 0 0 8px 0; font-size: 12px; color: #999; text-transform: uppercase; font-weight: 500;">–°—Ç–∞—Ç—É—Å</p>
                    <p style="margin: 0; color: #333; font-size: 15px;">{{ law.get_status_display }}</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <p style="margin: 0 0 8px 0; font-size: 12px; color: #999; text-transform: uppercase; font-weight: 500;">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</p>
                    <p style="margin: 0; color: #333; font-size: 15px;">
                        {% if law.is_active %}
                            <span style="color: #28a745;">‚úì –î–µ–π—Å—Ç–≤—É–µ—Ç</span>
                        {% else %}
                            <span style="color: #dc3545;">‚úó –ù–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç</span>
                        {% endif %}
                    </p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <p style="margin: 0 0 8px 0; font-size: 12px; color: #999; text-transform: uppercase; font-weight: 500;">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</p>
                    <p style="margin: 0; color: #333; font-size: 15px;">{{ law.views_count }}</p>
                </div>
                
                <div style="padding-top: 20px; border-top: 1px solid #ddd;">
                    <p style="margin: 0 0 8px 0; font-size: 12px; color: #999; text-transform: uppercase; font-weight: 500;">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</p>
                    <p style="margin: 0; color: #333; font-size: 14px;">{{ law.created_at|date:"d.m.Y H:i" }}</p>
                </div>
            </aside>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
        {% if history %}
        <div class="law-history" style="background: white; padding: 25px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h2 style="margin-top: 0; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 15px;">üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</h2>
            
            <div style="display: flex; flex-direction: column; gap: 15px;">
                {% for record in history %}
                    <div style="padding: 15px; background: #f8f9fa; border-left: 4px solid #007bff; border-radius: 4px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <p style="margin: 0; color: #333; font-weight: 500;">
                                {{ record.change_description }}
                            </p>
                            <span style="font-size: 12px; color: #999;">
                                {{ record.created_at|date:"d.m.Y H:i" }}
                            </span>
                        </div>
                        {% if record.changed_by %}
                            <p style="margin: 0; font-size: 13px; color: #666;">
                                –ò–∑–º–µ–Ω–µ–Ω–æ: <strong>{{ record.changed_by.username }}</strong>
                            </p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
        <div class="law-comments" style="background: white; padding: 25px; border-radius: 8px; border: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h2 style="margin-top: 0; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 15px;">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ law.law_comments.count }})</h2>
            
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
            {% if user.is_authenticated %}
            <div style="margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                <h3 style="margin-top: 0; color: #333; font-size: 16px; margin-bottom: 15px;">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
                
                <form method="post" style="display: flex; flex-direction: column; gap: 15px;">
                    {% csrf_token %}
                    
                    {{ form.text }}
                    
                    <button type="submit" class="btn" style="padding: 12px 25px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 500; align-self: flex-start;">
                        –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
                    </button>
                </form>
            </div>
            {% else %}
            <div style="margin-bottom: 30px; padding: 20px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 8px;">
                <p style="margin: 0; color: #856404;">
                    <a href="{% url 'login_view' %}" style="color: #007bff; text-decoration: none;">–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</a> 
                    —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
                </p>
            </div>
            {% endif %}
            
            <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
            {% if comments %}
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    {% for comment in comments %}
                        <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                <p style="margin: 0; color: #333; font-weight: 500;">
                                    {{ comment.author.username }}
                                </p>
                                <span style="font-size: 12px; color: #999;">
                                    {{ comment.created_at|date:"d.m.Y H:i" }}
                                </span>
                            </div>
                            
                            <p style="margin: 10px 0 0 0; color: #555; line-height: 1.6;">
                                {{ comment.text }}
                            </p>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div style="text-align: center; padding: 30px; background: #f8f9fa; border-radius: 8px;">
                    <p style="color: #666;">–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –¥–æ–±–∞–≤–∏—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π!</p>
                </div>
            {% endif %}
        </div>
    </div>
</main>
{% endblock %}

<script src="{% static './JS/script.js' %}"></script>